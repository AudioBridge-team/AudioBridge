= Changelog =

Все существенные изменения данного проекта будут задокументированы в этом файле.

Формат основан на [https://keepachangelog.com/en/1.0.0/ Keep a Changelog], и этот проект придерживается [https://semver.org/spec/v2.0.0.html Semantic Versioning].

== [https://github.com/shonqwezon-team/AudioBridge/compare/prod...dev Unreleased] ==

== [https://github.com/shonqwezon-team/AudioBridge/compare/v1.3.0...v1.3.1 1.3.1] - 20-09-2022 ==

=== Added ===

* Добавлен новый конфигурационный файл <code>bot_settings.json</code>, в котором прописаны настройки обработки запросов пользователя и конвертации видео
* Создан новый класс <code>GroupManager.py</code> для управления группой вк

=== Changed ===

* Полностью переработана структура программы: каждый класс был вынесен в соответствующий ему модуль. Такое решение структуризирует ведение проекта и упрощает его дальнейшее развитие
* Обработка конфига программы переписана с использованием библиотеки <code>betterconf</code>. Это сделано для более удобной работы с конфигурационными файлами <code>.env</code> и <code>bot_settings.json</code>
* '''Прикреплённые''' YouTube видео обрабатываются как запрос, не содержащий ссылку

== [https://github.com/shonqwezon-team/AudioBridge/compare/v1.2.9...v1.3.0 1.3.0] — 31-08-2022 ==

=== Added ===

* Добавлена функция в <code>audioBridge.py</code> <code>vk_video_handler</code> для получения прямой ссылки на прикреплённое видео

=== Changed ===

* Были оптимизированы переменные контейнера <code>PYTHONDONTWRITEBYTECODE=1</code> и <code>PYTHONUNBUFFERED=1</code> на аналогичными по функционалу параметрами запуска <code>-Bu</code> в команде <code>ENTRYPOINT</code>

=== Fixed ===

* Исправлена обработка видеозаписей ВКонтакте

== [https://github.com/shonqwezon-team/AudioBridge/compare/v1.2.8...v1.2.9 1.2.9] — 30-08-2022 ==

=== Added ===

* Добавлено отсеивание запросов от пользователей, не содержащих в себе ссылки
* Добавлена обработка видео типа YouTube Shorts

=== Changed ===

* Был улучшен и оптимизирован принцип обработки сообщений от пользователя

== [https://github.com/shonqwezon-team/AudioBridge/compare/v1.2.7...v1.2.8 1.2.8] — 27-08-2022 ==

=== Added ===

* Добавлена переменная <code>ENV PYTHONDONTWRITEBYTECODE=1</code> в файл конфигурации контейнера (<code>Dockerfile</code>)
* Добавлена переменная <code>ENV PYTHONUNBUFFERED=1</code> в файл конфигурации контейнера (<code>Dockerfile</code>)
* Добавлен файл <code>docker-compose.yml</code> для запуска утилиты <code>docker compose</code>

=== Changed ===

* Изменено имя файла логов
* Изменён скрипт автоматического развёртывания и установки бота на стороне сервера <code>install.zsh</code> из-за перехода на утилиту <code>docker compose</code>

=== Removed ===

* Убрана функция <code>create_db</code> из файла <code>db/database.py</code>, т.к. созданием баз данных и ролей для них занимается утилита <code>docker compose</code>

== [https://github.com/shonqwezon-team/AudioBridge/compare/v1.2.6...v1.2.7 1.2.7] — 25-08-2022 ==

=== Added ===

* Добавлено логгирование действий пользователей и бота в файл

=== Changed ===

* Изменена модель ведения проекта на Github (разделение на ветки, документ «Общее положение о ведении проекта»)
* Изменена инфраструктура репозитория и структура хранения файлов на сервере
* Изменён скрипт автоматического развёртывания и установки бота на стороне сервера (<code>install.zsh</code>)

=== Removed ===

* Убран режим отладки (debug-режим) из prod-версии в связи с тем, что режимы были разделены по разнесеным группам
* Убрана возможность запуска бота в режиме отладки
* Убрано переключение между dev- и prod-версиями
* Убрано разделение ролей в связи с тем, что необходимость в командах разработчика отпала
* Убрана таблица для ролей в БД
* Убраны ID разработчиков в файле конфигурации окружения (<code>.env</code>)
* Убраны команды для разработчиков (<code>commands/dev.py</code>)
* Убран класс <code>PermissionsType</code>, предназначенный для команд разработчиков

== [https://github.com/shonqwezon-team/AudioBridge/compare/v1.2.5...v1.2.6 1.2.6] — 23-08-2022 ==

=== Added ===

* Добавлена поддержка БД PostgresSQL
* Добавлено прототипные версии описаний к каждому классу и функции
* Добавлена загрузка ролей в оперативную память (кеширование) для работы системы переключений версий

=== Changed ===

* Доработа полноценная версия системы переключения между версиями (<code>prod.</code> и <code>dev.</code>) бота для разработчиков
* Изменена инфраструктура репозитория и структура хранения файлов на сервере
* Изменена архитектура пользовательских команд

=== Fixed ===

* Исправлена ошибка, из-за которой автоматическое развёртывание на dev-сервере не работало корректно

== [https://github.com/shonqwezon-team/AudioBridge/compare/v1.2.4...v1.2.5 1.2.5] — 20-08-2022 ==

=== Added ===

* Добавлена прототипная версия системы переключения между версиями (production — <code>prod.</code> и development — <code>dev.</code>) бота для разработчиков
* Добавлена обработка аргументов (версия и режим отладки) для разработчиков
* Добавлена обработка последнего неотвеченного сообщения в случае обновления или падения бота
* Добавлено автоматическое развёртывание на dev-сервере Github-релиза через push с помощью Github Action

=== Changed ===

* Изменено внутреннее содержание файла <code>src/config.py</code> — класс <code>Cfg</code> был подразделён на классы <code>Settings</code>, <code>RequestIndex</code>, <code>PlaylistStates</code> в целях удобочитаемости кода

=== Fixed ===

* Незначительное обновление исходного кода бота с прошлых версий
* Разностороннее оптимизация основного исполняемого файла бота — <code>audioBridge.py</code>

== [https://github.com/shonqwezon-team/AudioBridge/compare/v1.2.3...v1.2.4 1.2.4] — 17-08-2022 ==

=== Added ===

* Добавлено автоматическое развёртывание на production-сервере Github-релиза через tag с помощью Github Action

=== Fixed ===

* Исправлена ошибка формата файла конфигурации окружения (<code>.env</code>), из-за которой <code>Docker</code> отказывался загружать переменные этого файла

== [https://github.com/shonqwezon-team/AudioBridge/compare/v1.1.7...v1.2.3 1.2.3] — 13-08-2022 ==

=== Added ===

* Расширен синтаксис команды ввода — добавлена возможность скачивать несколько треков из предоставляемого плейлиста
* Расширена возможность получения информации об обрабатываемом треке — автор и название (раньше была доступна информация лишь об авторе)
* Добавлена настройка сервера на кол-во обработчиков запросов (worker'ов), одновременно работающих с очередью запросов каждого пользователя
* Добавление обработчика кастомных пользовательских команд
* Добавлена пользовательская команда для работы с процессом загрузки (<code>/clear</code> — очищение очереди запросов текущего пользователя)

=== Changed ===

* Обновлены и дополнены правила фильтрации ввода команды (&quot;Защита от пользователя&quot;)

=== Fixed ===

* Исправлено критическая ошибка, при которой еженочный перезапуск API-сервера со стороны VK вызывал падение из-за непредвиденной ошибки в классе <code>Vk Api Longpoll</code>
* Исправлена логическая ошибка, при которой добавление нового запроса в общую очередь приводило к тому, что запрос добавлялся не в конец общей очереди, а в конец &quot;локальной&quot; очереди автора
* Разностороннее обновление и оптимизация исходного кода бота

== [https://github.com/shonqwezon-team/AudioBridge/compare/v1.1.2...v1.1.7 1.1.7] — 14-07-2022 ==

=== Added ===

* Добавлена очистка сообщений для пользователя, содержащее процесс выполнения запроса (&quot;<code>Добавлено в очередь (*/5)</code>&quot; и сколько скачано)

=== Removed ===

* Убраны неиспользуемые обработчики событий от класса <code>Vk Api Longpoll</code> для оптимизации кода

== [https://github.com/shonqwezon-team/AudioBridge/compare/v1.0.0...v1.1.2 1.1.2] — 18-05-2022 ==

=== Added ===

* Добавлена фильтрация ввода команды (&quot;Защита от пользователя&quot;)
* Добавлено ограничение на количество обработчиков '''общей''' очереди запросов (только 5 операций)
* Добавлено логгирование действий пользователей и бота в консоль

=== Changed ===

* Расширен синтаксис команды ввода — добавлена возможность создавать аудиофрагменты
* Отредактированы описания ошибок, выдаваемых ботом пользователям

=== Fixed ===

* Исправлена ошибка, при которой при получении ботом ссылки на плейлист, происходило скачивание всего плейлиста вместо первой песни
* Исправлена критическая ошибка, при которой появление непредвиденных ошибок от библиотеки <code>youtube-dl</code> вызывало падение бота — добавлен обработчик

== [https://github.com/shonqwezon-team/AudioBridge/releases/tag/v1.0.0 1.0.0] — 15-04-2022 ==

* Initial release

<!-- Links -->
<!-- Versions -->
